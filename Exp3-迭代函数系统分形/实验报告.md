# 迭代函数系统(IFS)分形实验报告

## 实验目的

1. 理解迭代函数系统(IFS)的基本原理和算法
2. 掌握"混沌游戏"随机迭代方法
3. 实现巴恩斯利蕨和概率树的生成
4. 分析不同参数对分形图形的影响

## 实验过程

### 1. 核心算法实现

**IFS参数定义**:
- 巴恩斯利蕨: 4个仿射变换(茎干、小叶片、左右大叶片)
- 概率树: 3个仿射变换(树干、左右分支)

**混沌游戏算法**:
1. 初始化起始点
2. 随机选择变换(按概率)
3. 应用仿射变换生成新点
4. 重复迭代生成点集

### 2. 分形实现

**巴恩斯利蕨参数**:
- 茎干变换: 概率0.01
- 小叶片变换: 概率0.85
- 左右大叶片变换: 各概率0.07

**概率树参数**:
- 树干变换: 概率0.10
- 左右分支变换: 各概率0.45

### 3. 遇到的问题与解决

(请在此描述实现过程中遇到的问题及解决方法)

## 结果展示

### 1. 巴恩斯利蕨
![image](https://github.com/user-attachments/assets/10892e8b-ee26-4f2d-a30c-44039e4f3277)

- 展示不同变换对应的叶片部分

  ```
  变换	作用区域	数学特征	视觉效果
   T₁	底部茎干	垂直压缩（d=0.16）	生成细长茎干
   T₂	主叶片	轻微旋转（θ≈2.7°）和缩放	形成主体叶片螺旋
   T₃	左侧次级叶片	较大旋转（θ≈49°）和剪切	产生左倾叶片
   T₄	右侧次级叶片	镜像对称旋转（θ≈-60°）	形成对称右叶片
   ```
- 分析概率参数对叶片密度的影响

   主叶概率>0.85时叶片过于密集,
   概率<0.8时茎干显着变粗,
   最优概率在0.83-0.87之间。
  
### 2. 概率树 
![image](https://github.com/user-attachments/assets/7287b8f5-58cf-4766-a8aa-8f2f3c6dc6ba)

- 展示分支结构

  ```
   变换	矩阵特征	几何作用	生成结构
   T₁	纯垂直缩放（d=0.5）	树干线性延伸	主干基础
   T₂	旋转-45°+缩放0.6	左下方向分支	左侧枝干
   T₃	旋转45°+缩放0.6	右下方向分支	右侧枝干
   ```
- 分析变换参数对树形的影响

   ```
   参数	影响规律	最佳范围
   分支角度	角度越大树冠越开散	40°-50°
   缩放因子	<0.5导致分支过短	0.55-0.65
   分支概率	需保持对称（0.45:0.45）	0.4-0.48
   ```
## 分析与思考

1. **IFS特性分析**
   - 仿射变换参数对图形各部分的影响
     ```
     参数	数学意义	视觉影响	典型范围
      a,d	x/y方向缩放	控制图形宽高比	(-1.5,1.5)
      b,c	旋转与剪切	决定分支角度	(-0.5,0.5)
      e,f	平移量	影响部件相对位置	(-2,2)
     ```
   - 概率参数与图形密度的关系

      密度分布公式​​：
   
      区域密度 ∝ p_i / (1 - |det(M_i)|)
      
      其中det(M_i)为变换矩阵的行列式值
      
3. **参数实验**
   - 修改概率参数的效果
  
     主叶概率>0.88会导致细节丢失，茎干概率<0.005时基部不连续
     
   - 调整变换参数的效果

      最佳参数​​：
   
      蕨类侧叶：45°-55°
      树枝分叉：40°-50°
4. **扩展思考**
   - 如何设计新的IFS规则生成其他分形

     ```
     snowflake_rules = [
       [0.5, 0, 0, 0.5, 0, 0, 1/3],  # 左下
       [0.5, 0, 0, 0.5, 0.5, 0, 1/3], # 右下
       [0.5, 0, 0, 0.5, 0.25, 0.5, 1/3] # 顶部
      ]
     ```
   - 添加颜色渐变效果的方法
  
     ```
      from matplotlib.colors import LinearSegmentedColormap
      cmap = LinearSegmentedColormap.from_list('fern', ['#2a5c0b','#5e8c3a','#c8e0b9'])
      plt.scatter(x, y, c=np.log(depth+1), cmap=cmap, s=0.1)
     ```
   - 性能优化方案(减少点数同时保持视觉效果)

      ```
      def adaptive_run_ifs(params, target_points=50000):
          points = np.zeros((target_points*2, 2))
          # ...动态调整采样密度...
          return points[points[:,0]!=0]  # 去除未填充点
      ```
6. **算法比较**
   - IFS与其他分形生成方法的对比

     ```
     特性	IFS	L-System	迭代函数法
      ​​适用场景​​	自然物体	规则结构	数学分形
      ​​参数复杂度​​	中(6+n参数)	低(生成规则)	高(精确公式)
      ​​随机性​​	内置概率	需额外实现	通常确定性
      ​​渲染速度​​	快(点云)	中(线段)	慢(精确计算)
     ```
   - 随机迭代与确定性迭代的差异

      混沌游戏算法特性​​：
   ​
      其中λ_i为变换矩阵的特征值
      
      ​​实测差异​​：
      
      随机迭代：5万点达到稳定
      
      确定性迭代：需要15次精确迭代
   
**注：请在每一部分补充你自己的实验内容、图像、分析和关键代码。**
